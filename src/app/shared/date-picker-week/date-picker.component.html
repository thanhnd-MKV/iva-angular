<div class="date-picker" #inputWrapperRef>
  <div class="input-wrapper" (click)="toggleCalendar()">
    <span class="calendar-icon"></span>
    <input type="text" [value]="formattedDate" readonly placeholder="Chọn ngày"/>
    <span
      *ngIf="selectedWeek"
      class="clear-icon" 
      (click)="clearData(); $event.stopPropagation()">×</span>
  </div>

  <div class="popup" *ngIf="isOpen" #popupRef [class.top]="popupPosition === 'top'">
    <div class="calendar-header">
      <button class="nav-button" (click)="changeMonth(-1)">&lt;</button>
      <div class="month-year">
        <span class="month" (click)="toggleMonthDropdown()">
          {{ months[displayDate.getMonth()] }}
        </span>
        <span class="year" (click)="toggleYearDropdown()">
          {{ displayDate.getFullYear() }}
        </span>
      </div>
      <button class="nav-button" (click)="changeMonth(1)">&gt;</button>
    </div>

    <div class="weekdays">
      <div class="weekday" *ngFor="let day of weekdays">{{ day }}</div>
    </div>

    <div class="days">
      <div
        *ngFor="let day of days"
        class="day"
        [class.other-month]="!day.isCurrentMonth"
        [class.selected]="day.isInSelectedWeek"
        (click)="selectDate(day)"
      >
        {{ day.dayOfMonth }}
        <div class="week-indicator" *ngIf="day.isCurrentMonth">
          Tuần {{ day.weekNumber }}
        </div>
      </div>
    </div>

    <!-- Dropdown cho tháng -->
    <div class="month-dropdown" *ngIf="showMonthDropdown">
      <div class="option" 
           *ngFor="let month of months; let i = index" 
           (click)="selectMonth(i); $event.stopPropagation()"
           [class.selected]="i === displayDate.getMonth()">
        {{ month }}
      </div>
    </div>

    <!-- Dropdown cho năm -->
    <div class="year-dropdown" *ngIf="showYearDropdown">
      <div class="option" 
           *ngFor="let year of years" 
           (click)="selectYear(year); $event.stopPropagation()"
           [class.selected]="year === displayDate.getFullYear()">
        {{ year }}
      </div>
    </div>
  </div>
</div>