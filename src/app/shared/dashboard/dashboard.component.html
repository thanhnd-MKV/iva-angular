<div class="dashboard-container">
  <div class="charts-grid-header" style="display: flex;justify-content: space-between;width: 100%;">
    <section class="" >
    <div class="summary-cards-grid">
        <app-summary-card *ngFor="let summary of summaryData" [title]="summary.title" [value]="summary.value"
        [percentageChange]="summary.percentageChange" [isPositive]="summary.isPositive" class="summary-card-custom"
        [class]="summary.class">
      </app-summary-card>
    </div>
  </section>
  <div class="export-report-container">
    <button 
      class="export-report-btn" 
      [disabled]="isExportingReport" 
      (click)="exportReport()">
      <mat-spinner *ngIf="isExportingReport" diameter="16" class="spinner"></mat-spinner>
      <span *ngIf="!isExportingReport" class="export-icon">üìä</span>
      <span class="export-text">Xu·∫•t b√°o c√°o</span>
    </button>
  </div>
  </div>
  <section class="charts-grid">
    <!-- Chart th·ªëng k√™ s·ªë l∆∞·ª£ng l·∫•n chi·∫øm -->
    <div class="chart-card vehicle-type-chart">
      <div class="header" style="display: flex; justify-content: space-between; align-items: center;margin-top: -16px;">
        <h3 class="chart-title">Th√¥ng k√™ s·ªë l∆∞·ª£ng l·∫•n chi·∫øm</h3>
        <app-date-range-picker (dateRangeSelected)="onDateRangeSelected($event)"></app-date-range-picker>
      </div>
      <div class="chart-wrapper" [class.loading]="isVehicleViolationLoading" style="height: 220px; position: relative;margin-top: -20px;margin-bottom: 10px;">
        <div *ngIf="isVehicleViolationLoading" class="loading-overlay">
          <mat-spinner diameter="40"></mat-spinner>
          <span class="loading-text">ƒêang t·∫£i d·ªØ li·ªáu bi·ªÉu ƒë·ªì...</span>
        </div>
        <canvas baseChart [data]="vehicleViolationData" [options]="vehicleViolationOptions" type="bar">
        </canvas>
      </div>
    </div>

    <div class="charts-grid-header-container">
    </div>

    <div class="charts-grid-bottom-container">
      <!-- Time slot table -->
      <div class="chart-card timeslot-table full-width-item " style="padding: 0 16px;">
        <div class="timeslot-chart-wrapper ">
          <div style="display: flex; justify-content: space-between; align-items: center;margin-top: -16px;">
            <h3 class="chart-title">L·∫•n chi·∫øm theo khung gi·ªù</h3>
            <app-date-picker-week (weekSelected)="onTimeSlotWeekSelected($event)"
              style="transform: scale(0.88);margin-right: -10px;">
            </app-date-picker-week>
          </div>
          <div class="table-wrapper" [class.loading]="isTimeSlotLoading" style="position: relative;">
            <div *ngIf="isTimeSlotLoading" class="loading-overlay">
              <mat-spinner diameter="40"></mat-spinner>
              <span class="loading-text">ƒêang t·∫£i d·ªØ li·ªáu khung gi·ªù...</span>
            </div>
            <table>
              <tbody>
                <tr *ngFor="let row of violationsByTimeSlotData">
                  <td class="day-column">{{ row.day }}</td>
                  <td *ngFor="let slotValue of row.slots" 
                      [ngClass]="{'highlight': slotValue > 0}">
                    {{ slotValue > 0 ? slotValue : '' }}
                  </td>
                </tr>
              </tbody>
              <tfoot>
                <tr class="time-slots">
                  <td></td>
                  <td *ngFor="let label of timeSlotLabels">{{ label }}</td>
                </tr>
              </tfoot>
            </table>
          </div>
        </div>
      </div>

      <!-- Camera chart -->
      <div class="chart-card camera-violation-chart">
        <div class="header" style="display: flex; justify-content: space-between; align-items: center;margin-top: -16px;">
          <h3 class="chart-title">L∆∞·ª£t l·∫•n chi·∫øm theo Camera</h3>
          <app-date-range-picker (dateRangeSelected)="onCameraDateRangeSelected($event)"></app-date-range-picker>
        </div>
        <div class="chart-wrapper camera-chart-wrapper" [class.loading]="isCameraChartLoading"
          style="height: 170px; position: relative;">
          <!-- C·∫≠p nh·∫≠t theo format c·ªßa ph·∫ßn th·ªëng k√™ s·ªë l∆∞·ª£ng -->
          <div *ngIf="isCameraChartLoading" class="loading-overlay">
            <mat-spinner diameter="40"></mat-spinner>
            <span class="loading-text">ƒêang t·∫£i d·ªØ li·ªáu camera...</span>
          </div>
          <canvas baseChart [data]="cameraViolationData" [options]="cameraViolationOptions" type="bar">
          </canvas>
        </div>
      </div>
    </div>
  </section>
</div>