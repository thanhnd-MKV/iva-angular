<div class="filter-bar">
  <div class="filter-left">
    <!-- Khu vực Filter -->
    <div class="filter-btn-wrapper">
      <button class="filter-btn location-btn" [class.active]="showLocationFilter" (click)="toggleLocationFilter()">
        <img src="assets/icon/location.svg" alt="Location" class="btn-icon">
        <span>{{ getLocationFilterLabel() }}</span>
        <mat-icon class="dropdown-icon">expand_more</mat-icon>
      </button>
      
      <div class="dropdown-menu location-dropdown" *ngIf="showLocationFilter">
        <div class="dropdown-item" 
             *ngFor="let location of locationOptions"
             [class.selected]="selectedLocationFilter === location.value"
             (click)="selectLocationFilter(location.value)">
          {{ location.label }}
        </div>
      </div>
    </div>

    <!-- Loại Camera Filter -->
    <div class="filter-btn-wrapper">
      <button class="filter-btn camera-btn" [class.active]="showCategoryFilter" (click)="toggleCategoryFilter()">
        <img src="assets/icon/camera.svg" alt="Camera" class="btn-icon">
        <span>{{ getCategoryFilterLabel() }}</span>
        <mat-icon class="dropdown-icon">expand_more</mat-icon>
      </button>
      
      <div class="dropdown-menu camera-dropdown" *ngIf="showCategoryFilter">
        <div class="dropdown-item" 
             [class.selected]="selectedCategoryFilter === ''"
             (click)="selectCategoryFilter('')">
          Tất cả
        </div>
        <div class="dropdown-item" 
             [class.selected]="selectedCategoryFilter === 'TRAFFIC'"
             (click)="selectCategoryFilter('TRAFFIC')">
          Giao thông
        </div>
        <div class="dropdown-item" 
             [class.selected]="selectedCategoryFilter === 'PERSON'"
             (click)="selectCategoryFilter('PERSON')">
          Đối tượng người
        </div>
      </div>
    </div>

    <!-- Trạng thái Filter -->
    <div class="filter-btn-wrapper">
      <button class="filter-btn status-btn" [class.active]="showStatusFilter" (click)="toggleStatusFilter()">
        <span>{{ getStatusFilterLabel() }}</span>
        <mat-icon class="dropdown-icon">expand_more</mat-icon>
      </button>
      
      <div class="dropdown-menu status-dropdown" *ngIf="showStatusFilter">
        <div class="dropdown-item" 
             [class.selected]="selectedStatusFilter === ''"
             (click)="selectStatusFilter('')">
          Tất cả
        </div>
        <div class="dropdown-item" 
             [class.selected]="selectedStatusFilter === 'online'"
             (click)="selectStatusFilter('online')">
          Online
        </div>
        <div class="dropdown-item" 
             [class.selected]="selectedStatusFilter === 'offline'"
             (click)="selectStatusFilter('offline')">
          Offline
        </div>
      </div>
    </div>

    <!-- Camera Filter -->
    <div class="filter-btn-wrapper">
      <button class="filter-btn camera-select-btn" [class.active]="showCameraFilter" (click)="toggleCameraFilter()">
        <span>Camera: {{ getCameraFilterLabel() }}</span>
        <mat-icon class="dropdown-icon">expand_more</mat-icon>
      </button>
      
      <div class="dropdown-menu camera-select-dropdown" *ngIf="showCameraFilter">
        <div class="dropdown-item" 
             [class.selected]="selectedCameraFilter === ''"
             (click)="selectCameraFilter('')">
          Tất cả
        </div>
        <div class="dropdown-item" 
             *ngFor="let camera of cameras"
             [class.selected]="selectedCameraFilter === camera.sn"
             (click)="selectCameraFilter(camera.sn)">
          {{ camera.cameraName || camera.sn }}
        </div>
      </div>
    </div>
  </div>

  <div class="filter-right">
    <button class="filter-btn clear-btn" (click)="clearFilters()">
      <mat-icon class="btn-icon">close</mat-icon>
      <span>Xóa bộ lọc</span>
    </button>
  </div>
</div>

<div class="dashboard-container">
  <!-- Camera List Section -->
  <div class="camera-list-sidebar">
    <div class="sidebar-header">
      <h3>Tổng: <span [appCountUp]="totalCameras" [duration]="800"></span> Camera</h3>
    </div>
    
    <div class="camera-list-content" *ngIf="!loadingCameras">
      <div class="camera-card" 
           [class.camera-offline]="camera.connectionStatus === 0" 
           [class.camera-selected]="selectedCameraCode === camera.sn"
           *ngFor="let camera of filteredCameras">
        <div class="card-top">
          <h2 class="camera-name">{{ camera.cameraName || camera.sn }}</h2>
          <div class="actions">
            <div class="status-badge" 
                 [class.status-on]="camera.connectionStatus === 1"
                 [class.status-off]="camera.connectionStatus === 0">
              <div class="dot" [class.dot-green]="camera.connectionStatus === 1" [class.dot-red]="camera.connectionStatus === 0"></div>
              {{ camera.connectionStatus === 1 ? 'ON' : 'OFF' }}
            </div>
            <button class="settings-btn" >
              <mat-icon>settings</mat-icon>
            </button>
          </div>
        </div>
        <div class="card-bottom">
          <div class="camera-info">
            <img src="assets/icon/camera.svg" alt="Category" class="info-icon">
            {{ getCategoryLabel(camera.category) }}
          </div>
          <div class="event-info">
            Sự kiện: <span class="event-number" [appCountUp]="camera.eventCount || 0" [duration]="600"></span>
          </div>
        </div>
      </div>
    </div>
    
    <div class="loading-container" *ngIf="loadingCameras">
      <mat-spinner diameter="40"></mat-spinner>
      <p>Đang tải danh sách camera...</p>
    </div>
  </div>
  
  <!-- Map Section -->
  <div class="map-section">
    <div class="map-card">
      <div class="map-wrapper">
        <app-traffic-flow-map 
          [cameraLocations]="cameraLocations"
          (cameraSelected)="onCameraSelectedFromMap($event)"
          (infoWindowClosed)="onInfoWindowClosed()">
        </app-traffic-flow-map>
      </div>
    </div>
  </div>
</div>
