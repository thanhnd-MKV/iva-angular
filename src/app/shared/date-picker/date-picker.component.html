<div class="datepicker-container" (click)="$event.stopPropagation()">
  <div #inputWrapperRef class="input-wrapper" (click)="toggleCalendar()" [class.disabled]="disabled">
    <span class="calendar-icon"></span>
    <input type="text" [value]="formattedDate" readonly [placeholder]="placeholder" [disabled]="disabled">
  </div>

  <div #popupRef class="calendar-popup" *ngIf="isOpen" [ngClass]="popupPosition">
    <div class="calendar-header">
      <button class="nav-arrow" (click)="changeMonth(-1)">&lt;</button>
      <div class="month-year">
        <div class="month-select" (click)="toggleMonthDropdown()">
          {{ months[displayDate.getMonth()] }}
          <div class="dropdown" *ngIf="showMonthDropdown">
            <div *ngFor="let month of months; let i = index" 
                 [class.current-month]="i === displayDate.getMonth()"
                 (click)="selectMonth(i)">
              {{ month }}
            </div>
          </div>
        </div>

        <div class="year-select" (click)="toggleYearDropdown()">
          {{ displayDate | date: 'yyyy' }}
          <span class="arrow-icon"></span>
          <div class="dropdown-year" *ngIf="showYearDropdown">
            <div *ngFor="let year of years" 
                 [class.current-year]="year === displayDate.getFullYear()"
                 (click)="selectYear(year)">
              {{ year }}
            </div>
          </div>
        </div>
      </div>
      <button class="nav-arrow" (click)="changeMonth(1)">&gt;</button>
    </div>

    <div class="calendar-grid">
      <div *ngFor="let day of weekdays" class="weekday">{{ day }}</div>
      <div *ngFor="let day of days" class="day-cell" [ngClass]="{
          'other-month': !day.isCurrentMonth,
          'selected': day.isSelected,
        }" (click)="selectDate(day)">
        {{ day.dayOfMonth }}
      </div>
    </div>
  </div>
</div>