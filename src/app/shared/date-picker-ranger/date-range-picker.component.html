<div class="daterangepicker-container" (click)="$event.stopPropagation()">
  <div #inputWrapperRef class="input-wrapper" (click)="toggleCalendar()">
    <span class="calendar-icon"></span>
    <input type="text" [value]="formattedDateRange" readonly placeholder="Chọn ngày">
    <span *ngIf="startDate || endDate" class="clear-icon" (click)="clearData(); $event.stopPropagation()">×</span>
  </div>
  
  <div #popupRef 
       class="calendar-popup" 
       [class.popup-right]="popupAlignment === 'right'"
       [class.popup-compact]="useCompactMode"
       [class.popup-top]="popupPosition === 'top'"
       *ngIf="isOpen">
    <div class="calendar-header">
      <button class="nav-arrow" (click)="changeMonth(-1)">&lt;</button>

      <div class="month-year-displays">
        <div class="calendar-controls">
          <div class="month-select" (click)="toggleLeftMonthDropdown()">
            {{ months[leftCalendarDate.getMonth()] }}
            <div class="dropdown" *ngIf="showLeftMonthDropdown">
              <div *ngFor="let month of months; let i = index" 
                   [class.current-month]="i === leftCalendarDate.getMonth()"
                   (click)="selectLeftMonth(i); $event.stopPropagation()">
                {{ month }}
              </div>
            </div>
          </div>
          <div class="year-select" (click)="toggleLeftYearDropdown()">
            {{ leftCalendarDate | date: 'yyyy' }}
            <div class="dropdown-year" *ngIf="showLeftYearDropdown">
              <div *ngFor="let year of years" 
                   [class.current-year]="year === leftCalendarDate.getFullYear()"
                   (click)="selectLeftYear(year); $event.stopPropagation()">
                {{ year }}
              </div>
            </div>
          </div>
        </div>

        <div class="calendar-controls">
          <div class="month-select" (click)="toggleRightMonthDropdown()">
            {{ months[rightCalendarDate.getMonth()] }}
            <div class="dropdown" *ngIf="showRightMonthDropdown">
              <div *ngFor="let month of months; let i = index" 
                   [class.current-month]="i === rightCalendarDate.getMonth()"
                   (click)="selectRightMonth(i); $event.stopPropagation()">
                {{ month }}
              </div>
            </div>
          </div>
          <div class="year-select" (click)="toggleRightYearDropdown()">
            {{ rightCalendarDate | date: 'yyyy' }}
            <div class="dropdown-year" *ngIf="showRightYearDropdown">
              <div *ngFor="let year of years" 
                   [class.current-year]="year === rightCalendarDate.getFullYear()"
                   (click)="selectRightYear(year); $event.stopPropagation()">
                {{ year }}
              </div>
            </div>
          </div>
        </div>
      </div>

      <button class="nav-arrow" (click)="changeMonth(1)">&gt;</button>
    </div>

    <div class="calendars-wrapper">
      <div class="calendar-panel">
        <div class="calendar-grid">
          <div *ngFor="let day of weekdays" class="weekday">{{ day }}</div>
          <div *ngFor="let day of leftCalendarDays" class="day-cell" 
               [ngClass]="getDayClasses(day)"
               (click)="selectDate(day)" 
               (mouseover)="hoverDate(day)">
            {{ day.dayOfMonth }}
          </div>
        </div>
      </div>

      <div class="calendar-panel">
        <div class="calendar-grid">
          <div *ngFor="let day of weekdays" class="weekday">{{ day }}</div>
          <div *ngFor="let day of rightCalendarDays" class="day-cell"
               [ngClass]="getDayClasses(day)"
               (click)="selectDate(day)"
               (mouseover)="hoverDate(day)">
            {{ day.dayOfMonth }}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>