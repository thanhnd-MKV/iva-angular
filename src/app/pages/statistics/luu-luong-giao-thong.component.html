<div class="filter-bar">
  <div class="filter-left">
    <!-- <div class="search-box">
      <mat-icon class="search-icon">search</mat-icon>
      <input type="text" placeholder="Tìm kiếm" class="search-input" [(ngModel)]="searchText"
        (keyup.enter)="onSearch()">
    </div> -->

    <div class="filter-btn-wrapper">
      <button class="filter-btn time-btn" [class.active]="showTimeDropdown" (click)="toggleTimeDropdown()">
        <mat-icon class="btn-icon">calendar_today</mat-icon>
        <span>{{ getTimeRangeLabel() }}</span>
        <mat-icon class="dropdown-icon">expand_more</mat-icon>
      </button>

      <div class="dropdown-menu time-dropdown" *ngIf="showTimeDropdown">
        <div class="dropdown-item" *ngFor="let option of timeOptions"
          [class.selected]="selectedTimeRange === option.value" (click)="selectTimeRange(option.value)">
          {{ option.label }}
        </div>
      </div>
    </div>

    <app-date-range-picker *ngIf="selectedTimeRange === 'custom'" (dateRangeSelected)="onDateRangeSelected($event)"
      (dateRangeCleared)="onDateRangeCleared()">
    </app-date-range-picker>

    <div class="filter-btn-wrapper">
      <button class="filter-btn camera-btn" [class.active]="showCameraDropdown || selectedCamera !== ''"
        (click)="toggleCameraDropdown()">
        <mat-icon class="btn-icon">videocam</mat-icon>
        <span>{{ getCameraLabel() }}</span>
        <mat-icon class="dropdown-icon">expand_more</mat-icon>
      </button>

      <div class="dropdown-menu camera-dropdown" *ngIf="showCameraDropdown">
        <div class="dropdown-item" *ngFor="let option of cameraOptions"
          [class.selected]="selectedCamera === option.value" (click)="selectCamera(option.value)">
          {{ option.label }}
        </div>
      </div>
    </div>

    <div class="filter-btn-wrapper">
      <button class="filter-btn area-btn" [class.active]="showAreaDropdown || selectedArea !== ''"
        (click)="toggleAreaDropdown()">
        <mat-icon class="btn-icon">location_on</mat-icon>
        <span>{{ getAreaLabel() }}</span>
        <mat-icon class="dropdown-icon">expand_more</mat-icon>
      </button>

      <div class="dropdown-menu area-dropdown" *ngIf="showAreaDropdown">
        <div class="dropdown-item" *ngFor="let option of areaOptions"
          [class.selected]="selectedArea === option.value" (click)="selectArea(option.value)">
          {{ option.label }}
        </div>
      </div>
    </div>

    <button class="filter-btn clear-btn" (click)="clearFilters()"
      *ngIf="hasActiveFilters || selectedTimeRange === 'custom'">
      <mat-icon class="btn-icon">close</mat-icon>
      <span>Xóa bộ lọc</span>
    </button>
  </div>

  <div class="filter-right">
    <button class="export-btn" (click)="exportReport()">
      <mat-icon class="btn-icon">download</mat-icon>
      <span>Xuất báo cáo</span>
    </button>
  </div>
</div>

<div class="statistics-container">
  <!-- Main Content: Map (Left) and Chart (Right) -->
  <div class="main-content">
    <!-- Map Section (Left) -->
    <div class="map-section">
      <div class="map-card">
        <h3 class="chart-title">Lưu lượng theo camera</h3>
        <div class="map-wrapper">
          <app-traffic-flow-map 
            [cameraLocations]="cameraLocations"
            [mapCenter]="mapCenter"
            [mapZoom]="mapZoom">
          </app-traffic-flow-map>
        </div>
      </div>
    </div>

    <!-- Chart Section (Right) -->
    <div>
        <div class="summary-cards-section">
        <div class="summary-card" [ngClass]="'summary-card-' + card.color" *ngFor="let card of summaryCards">
          <div class="summary-header">
            <span class="summary-title">{{ card.title }}</span>
          </div>
          <div class="summary-body">
            <span class="summary-value">{{ card.value }}</span>
            <span class="summary-change" [class.positive]="card.isPositive" [class.negative]="!card.isPositive"
              *ngIf="card.change > 0">
              <mat-icon class="change-icon">{{ card.isPositive ? 'arrow_upward' : 'arrow_downward' }}</mat-icon>
              {{ card.change }}%
            </span>
          </div>
        </div>
      </div>
      <div class="chart-section">
        <div class="chart-card">
          <div class="chart-header">
            <h3 class="chart-title">Thống kê số lượng phương tiện</h3>
            <div class="chart-header-legend">
              <div class="legend-item" 
                   [class.inactive]="barChartFilter !== 'car' && barChartFilter !== 'all'"
                   (click)="setBarChartFilter(barChartFilter === 'car' ? 'all' : 'car')">
                <span class="legend-dot" style="background-color: #3b82f6;"></span>
                <span class="legend-text">Ô tô</span>
              </div>
              <div class="legend-item"
                   [class.inactive]="barChartFilter !== 'motorbike' && barChartFilter !== 'all'"
                   (click)="setBarChartFilter(barChartFilter === 'motorbike' ? 'all' : 'motorbike')">
                <span class="legend-dot" style="background-color: #10b981;"></span>
                <span class="legend-text">Xe máy</span>
              </div>
              <div class="legend-item"
                   [class.inactive]="barChartFilter !== 'truck' && barChartFilter !== 'all'"
                   (click)="setBarChartFilter(barChartFilter === 'truck' ? 'all' : 'truck')">
                <span class="legend-dot" style="background-color: #f59e0b;"></span>
                <span class="legend-text">Xe tải</span>
              </div>
              <div class="legend-item"
                   [class.inactive]="barChartFilter !== 'bus' && barChartFilter !== 'all'"
                   (click)="setBarChartFilter(barChartFilter === 'bus' ? 'all' : 'bus')">
                <span class="legend-dot" style="background-color: #ef4444;"></span>
                <span class="legend-text">Xe buýt</span>
              </div>
            </div>
          </div>
          <div class="chart-wrapper" [class.loading]="isBarChartLoading">
            <div *ngIf="isBarChartLoading" class="loading-overlay">
              <mat-spinner diameter="40"></mat-spinner>
            </div>
            <canvas baseChart [data]="barChartData" [options]="barChartOptions" type="bar">
            </canvas>
          </div>
        </div>
      </div>
    
    </div>
  </div>
</div>